#!/bin/bash

pokemon_data_dir="pokemon_data"
output_csv="pokemon_report.csv"

echo "Name,Height (m),Weight (kg)" > "$output_csv"

if [ ! -d "$pokemon_data_dir" ]; then
    echo "Directory $pokemon_data_dir does not exist."
    exit 1
fi

# Initialize summary variables
total_pokemon=0
total_height=0
total_weight=0
types_count=()

# Process each json file
for json_file in "$pokemon_data_dir"/*.json; do
    if [ ! -f "$json_file" ]; then
        continue
    fi

    # Increment total Pokémon count
    total_pokemon=$((total_pokemon + 1))

    # Extract Pokémon name, height and weight
    name=$(jq -r '.name' "$json_file")
    name=$(echo "$name" | sed 's/^\(.\)/\U\1/')
    height=$(jq -r '.height' "$json_file" | awk '{print $1/10}')
    weight=$(jq -r '.weight' "$json_file" | awk '{print $1/10}')

    # Write Pokémon data to the CSV file
    {
        echo "$name, $height, $weight"
    } >> "$output_csv"

    total_height=$(echo "$total_height + $height" | bc)
    total_weight=$(echo "$total_weight + $weight" | bc)

    # Calculate average height and weight
    if [ "$total_pokemon" -gt 0 ]; then
        average_height=$(echo "scale=2; $total_height / $total_pokemon" | bc)
        average_weight=$(echo "scale=2; $total_weight / $total_pokemon" | bc)
    fi
done

# Print summary
echo "CSV Report generated at: $output_csv"
echo ""

# Print contents of the csv file
cat "$output_csv"
echo ""

echo "Average Height: ${average_height} m"
echo "Average Weight: ${average_weight} kg"
